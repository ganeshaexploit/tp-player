-- âœ¨ Teleport & Spectate by Ganesha Exploit (Final Full + Manual Refresh) âœ¨
-- âœ… Safe Teleport & Spectate
-- âœ… All player list auto
-- âœ… Random teleport
-- âœ… Floating draggable UI + Touch friendly
-- âœ… Auto refresh player list
-- âœ… Manual refresh button
-- âœ… Stop spectate if target dies/leaves

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local ContextActionService = game:GetService("ContextActionService")
local StarterGui = game:GetService("StarterGui")
local RunService = game:GetService("RunService")

local localPlayer = Players.LocalPlayer
local playerGui = localPlayer:WaitForChild("PlayerGui")

-- Config
local UI_WIDTH, UI_HEIGHT = 340, 600
local TELEPORT_COOLDOWN = 1
local TOGGLE_KEY = Enum.KeyCode.T
local REFRESH_INTERVAL = 5

-- ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "TeleportByGaneshaExploit"
screenGui.ResetOnSpawn = false
screenGui.Parent = playerGui

-- Floating icon
local floatIcon = Instance.new("TextButton")
floatIcon.Size = UDim2.new(0,50,0,50)
floatIcon.Position = UDim2.new(1,-60,1,-60)
floatIcon.BackgroundColor3 = Color3.fromRGB(200,80,80)
floatIcon.Text = "TP"
floatIcon.Font = Enum.Font.GothamBold
floatIcon.TextSize = 18
floatIcon.TextColor3 = Color3.new(1,1,1)
Instance.new("UICorner", floatIcon).CornerRadius = UDim.new(0,12)
floatIcon.ZIndex = 10
floatIcon.Parent = screenGui

-- Main frame
local main = Instance.new("Frame")
main.Size = UDim2.new(0,UI_WIDTH,0,UI_HEIGHT)
main.Position = UDim2.new(0,20,0,80)
main.BackgroundColor3 = Color3.fromRGB(25,25,25)
main.Visible = false
main.Parent = screenGui
Instance.new("UICorner", main).CornerRadius = UDim.new(0,12)
Instance.new("UIStroke", main).Color = Color3.fromRGB(50,50,55)

-- Title bar
local titleBar = Instance.new("Frame", main)
titleBar.Size = UDim2.new(1,0,0,44)
titleBar.BackgroundTransparency = 1

local title = Instance.new("TextLabel", titleBar)
title.Size = UDim2.new(1,-20,1,0)
title.Position = UDim2.new(0,10,0,0)
title.Text = "âœ¨ Teleport by Ganesha Exploit"
title.TextColor3 = Color3.new(1,1,1)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextXAlignment = Enum.TextXAlignment.Left
title.BackgroundTransparency = 1

-- Random Player button
local randomBtn = Instance.new("TextButton", main)
randomBtn.Size = UDim2.new(1,-20,0,32)
randomBtn.Position = UDim2.new(0,10,0,60)
randomBtn.Text = "ðŸŽ² Random Player"
randomBtn.Font = Enum.Font.GothamBold
randomBtn.TextSize = 14
randomBtn.TextColor3 = Color3.new(1,1,1)
randomBtn.BackgroundColor3 = Color3.fromRGB(70,130,180)
Instance.new("UICorner", randomBtn).CornerRadius = UDim.new(0,8)

-- Manual Refresh button
local refreshBtn = Instance.new("TextButton", main)
refreshBtn.Size = UDim2.new(1,-20,0,32)
refreshBtn.Position = UDim2.new(0,10,0,100)
refreshBtn.Text = "ðŸ”„ Refresh Player List"
refreshBtn.Font = Enum.Font.GothamBold
refreshBtn.TextSize = 14
refreshBtn.TextColor3 = Color3.new(1,1,1)
refreshBtn.BackgroundColor3 = Color3.fromRGB(120,180,70)
Instance.new("UICorner", refreshBtn).CornerRadius = UDim.new(0,8)

-- Scroll container
local scroll = Instance.new("ScrollingFrame", main)
scroll.Size = UDim2.new(1,-20,1,-160)
scroll.Position = UDim2.new(0,10,0,140)
scroll.BackgroundTransparency = 1
scroll.ScrollBarThickness = 6
scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y

local layout = Instance.new("UIListLayout", scroll)
layout.Padding = UDim.new(0,6)

-- Teleport safe
local lastTeleport = 0
local function teleportToTarget(plr)
	if tick() - lastTeleport < TELEPORT_COOLDOWN then return end
	lastTeleport = tick()
	pcall(function()
		if plr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") and localPlayer.Character and localPlayer.Character:FindFirstChild("HumanoidRootPart") then
			localPlayer.Character.HumanoidRootPart.CFrame = plr.Character.HumanoidRootPart.CFrame + Vector3.new(2,0,2)
			StarterGui:SetCore("SendNotification",{
				Title = "Teleport by Ganesha Exploit",
				Text = "Teleported to "..plr.Name,
				Duration = 3
			})
		end
	end)
end

-- Spectate safe
local spectating = false
local spectateTarget = nil
local currentCamera = workspace.CurrentCamera

local function stopSpectate()
	spectating = false
	spectateTarget = nil
	RunService:UnbindFromRenderStep("Spectate")
	currentCamera.CameraType = Enum.CameraType.Custom
end

local function spectatePlayer(plr)
	if plr and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
		spectating = true
		spectateTarget = plr.Character
		RunService:BindToRenderStep("Spectate",301,function()
			if spectating and spectateTarget and spectateTarget:FindFirstChild("HumanoidRootPart") then
				currentCamera.CFrame = spectateTarget.HumanoidRootPart.CFrame * CFrame.new(0,5,10)
				currentCamera.CameraType = Enum.CameraType.Scriptable
			else
				stopSpectate()
			end
		end)
	end
end

-- Create Player Button
local function createPlayerButton(plr)
	if scroll:FindFirstChild("Player_"..plr.UserId) then return end
	local container = Instance.new("Frame", scroll)
	container.Size = UDim2.new(1,-4,0,80)
	container.BackgroundTransparency = 1
	container.Name = "Player_"..plr.UserId

	local teleportBtn = Instance.new("TextButton", container)
	teleportBtn.Size = UDim2.new(1,-4,0,36)
	teleportBtn.Position = UDim2.new(0,0,0,0)
	teleportBtn.Text = "Teleport â†’ "..plr.Name
	teleportBtn.Font = Enum.Font.GothamBold
	teleportBtn.TextSize = 14
	teleportBtn.TextColor3 = Color3.new(1,1,1)
	teleportBtn.BackgroundColor3 = Color3.fromRGB(70,130,180)
	Instance.new("UICorner", teleportBtn).CornerRadius = UDim.new(0,10)

	teleportBtn.MouseButton1Click:Connect(function()
		teleportToTarget(plr)
	end)

	local spectateBtn = Instance.new("TextButton", container)
	spectateBtn.Size = UDim2.new(1,-4,0,36)
	spectateBtn.Position = UDim2.new(0,0,0,44)
	spectateBtn.Text = "Spectate â†’ "..plr.Name
	spectateBtn.Font = Enum.Font.GothamBold
	spectateBtn.TextSize = 14
	spectateBtn.TextColor3 = Color3.new(1,1,1)
	spectateBtn.BackgroundColor3 = Color3.fromRGB(200,80,80)
	Instance.new("UICorner", spectateBtn).CornerRadius = UDim.new(0,10)

	spectateBtn.MouseButton1Click:Connect(function()
		if spectating and spectateTarget == plr.Character then
			stopSpectate()
			spectateBtn.Text = "Spectate â†’ "..plr.Name
		else
			spectatePlayer(plr)
			spectateBtn.Text = "Stop Spectate"
		end
	end)
end

-- Refresh player list safely
local function refreshPlayerList()
	for _, plr in ipairs(Players:GetPlayers()) do
		createPlayerButton(plr)
	end
end

-- Manual Refresh button
refreshBtn.MouseButton1Click:Connect(function()
	refreshPlayerList()
	StarterGui:SetCore("SendNotification",{
		Title = "Teleport by Ganesha Exploit",
		Text = "Player list refreshed âœ…",
		Duration = 2
	})
end)

-- Initial refresh & auto refresh loop
refreshPlayerList()
Players.PlayerAdded:Connect(refreshPlayerList)
Players.PlayerRemoving:Connect(function(plr)
	local btn = scroll:FindFirstChild("Player_"..plr.UserId)
	if btn then btn:Destroy() end
	if spectating and spectateTarget == plr.Character then stopSpectate() end
end)

task.spawn(function()
	while task.wait(REFRESH_INTERVAL) do
		refreshPlayerList()
	end
end)

-- Random teleport
randomBtn.MouseButton1Click:Connect(function()
	local candidates = {}
	for _, plr in ipairs(Players:GetPlayers()) do
		if plr ~= localPlayer then
			table.insert(candidates, plr)
		end
	end
	if #candidates > 0 then
		local target = candidates[math.random(1,#candidates)]
		teleportToTarget(target)
	end
end)

-- Toggle UI
local uiVisible = false
floatIcon.MouseButton1Click:Connect(function()
	uiVisible = not uiVisible
	main.Visible = uiVisible
end)
ContextActionService:BindAction("ToggleTeleportUI",function(_,state)
	if state==Enum.UserInputState.Begin then
		uiVisible = not uiVisible
		main.Visible = uiVisible
	end
end,false,TOGGLE_KEY)

-- Dragging (Mouse + Touch)
local function makeDraggable(frame)
	local dragging, dragStart, startPos
	frame.InputBegan:Connect(function(input)
		if input.UserInputType==Enum.UserInputType.MouseButton1 or input.UserInputType==Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = frame.Position
			input.Changed:Connect(function()
				if input.UserInputState==Enum.UserInputState.End then dragging=false end
			end)
		end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if dragging and (input.UserInputType==Enum.UserInputType.MouseMovement or input.UserInputType==Enum.UserInputType.Touch) then
			local delta = input.Position - dragStart
			frame.Position = UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,startPos.Y.Scale,startPos.Y.Offset+delta.Y)
		end
	end)
end

makeDraggable(main)
makeDraggable(floatIcon)
